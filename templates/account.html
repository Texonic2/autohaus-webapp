{% extends "base.html" %}

{% block title %}Mein Konto – Autohaus Heilbronn{% endblock %}

{% block content %}
<div class="konto-und-anfragen-container">

    <!--  Benutzerkonto-Daten -->
    <div class="konto-card">
        <h2 class="konto-ueberschrift"><span class="emoji"></span> Meine Kontodaten</h2>
        <p><strong>Vorname:</strong> {{ benutzer.vorname }}</p>
        <p><strong>Nachname:</strong> {{ benutzer.nachname }}</p>
        <p><strong>E-Mail:</strong> {{ benutzer.email }}</p>
        <p><strong>Rolle:</strong> {{ benutzer.role }}</p>

        <a href="{{ url_for('passwort_aendern') }}" class="btn-passwort-aendern"> Passwort ändern</a>
    </div>

    <!--  Finanzierungsanfragen -->
    <div class="finanzierungsanfrage-container">
        <h2> Meine Finanzierungsanfragen</h2>
        {% for anfrage in finanzierungsanfragen %}
        <div class="finanzierungsanfrage-card">
            <!-- Fahrzeugbild -->
            <div class="auto-bild">
                <img src="{{ url_for('static', filename=anfrage.url) }}" alt="{{ anfrage.marke }} {{ anfrage.modell }}">
            </div>
            <!-- Details zur Anfrage -->
            <div class="anfrage-details">
                <h3>{{ anfrage.marke }} {{ anfrage.modell }}</h3>
                <p><strong>Termin:</strong> {{ anfrage.Terminwunsch or 'Kein Termin angegeben' }}</p>
                <p><strong>Finanzierungsdauer:</strong> {{ anfrage.Monate }} Monate</p>
                <p><strong>Anzahlung:</strong> {{ "{:,.0f}".format(anfrage.Anzahlung).replace(",", ".") }} €</p>
                <p><strong>Monatliche Rate:</strong> {{ "{:,.0f}".format(anfrage.Monatliche_Rate|float).replace(",", "X").replace(".", ",").replace("X", ".") }} €</p>
                <p><strong>Schlussrate:</strong> {{ "{:,.0f}".format(anfrage.schlussrate).replace(",", ".") }} €</p>
                <p><strong>Status:</strong> <span class="status {{ anfrage.Status|lower }}">{{ anfrage.Status }}</span></p>

                <!-- Anfrage löschen -->
                <form action="{{ url_for('anfrage_loeschen', anfrage_id=anfrage.ID) }}" method="post"
                      onsubmit="return confirm('Willst du diese Anfrage wirklich löschen?');">
                    <button type="submit" class="btn-anfrage-loeschen"> Anfrage löschen</button>
                </form>
            </div>
        </div>
        {% else %}
        <p>Du hast bisher keine Finanzierungsanfragen gestellt.</p>
        {% endfor %}
    </div>

    <!--  Kaufverträge -->
    <div class="finanzierungsanfrage-container">
        <h2> Meine Kaufverträge</h2>
        {% for vertrag in kaufvertraege %}
        <div class="finanzierungsanfrage-card">
            <!-- Fahrzeugbild -->
            <div class="auto-bild">
                <img src="{{ url_for('static', filename=vertrag.url) }}" alt="{{ vertrag.marke }} {{ vertrag.modell }}">
            </div>
            <div class="anfrage-details">
                <h3>
                    {{ vertrag.marke }} {{ vertrag.modell }}
                    <!--  Tooltip -->
                    <span class="auto-info-tooltip">

                        <span class="auto-info-tooltip-text">
                            <table>
                                <tbody>
                                    <tr><td><strong>Baujahr:</strong></td><td>{{ vertrag.baujahr }}</td></tr>
                                    <tr><td><strong>Leistung:</strong></td><td>{{ vertrag.leistung }} PS</td></tr>
                                    <tr><td><strong>Preis:</strong></td><td>{{ "{:,.0f}".format(vertrag.preis).replace(",", ".") }} €</td></tr>
                                    <tr><td><strong>Hubraum:</strong></td><td>{{ vertrag.hubraum or '-' }}</td></tr>
                                    <tr><td><strong>Verbrauch:</strong></td><td>{{ vertrag.kraftstoffverbrauch or '-' }} l/100km</td></tr>
                                    <tr><td><strong>Getriebe:</strong></td><td>{{ vertrag.getriebeart or '-' }}</td></tr>
                                    <tr><td><strong>Antrieb:</strong></td><td>{{ vertrag.antriebsart or '-' }}</td></tr>
                                    <tr><td><strong>Plakette:</strong></td><td>{{ vertrag.umweltplakette or '-' }}</td></tr>
                                </tbody>
                            </table>
                        </span>
                    </span>
                </h3>
                <p><strong>Gekauft AM:</strong> {{ vertrag.Datum_Erstellung.strftime("%d.%m.%Y") }}</p>
                <p><strong>Adresse:</strong> {{ vertrag.kunde_adresse }}</p>
                <p><strong>Telefon:</strong> {{ vertrag.kunde_telefon }}</p>
                <p><strong>Monate:</strong> {{ vertrag.Monate }}</p>
                <p><strong>Anzahlung:</strong> {{ "{:,.0f}".format(vertrag.Anzahlung|float).replace(",", "X").replace(".", ",").replace("X", ".") }} €</p>
                <p><strong>Monatliche Rate:</strong> {{ "{:,.0f}".format(vertrag.Monatliche_Rate|float).replace(",", "X").replace(".", ",").replace("X", ".") }} €</p>
                <p><strong>Schlussrate:</strong> {{ vertrag.Schlussrate }} €</p>
            </div>
        </div>
        {% else %}
        <p>Du hast bisher keinen Kaufvertrag.</p>
        {% endfor %}
    </div>

</div>
{% endblock %}
