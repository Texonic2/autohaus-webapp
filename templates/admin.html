{% extends "base.html" %}

{% block head %}

{% endblock %}

{% block title %}Startseite â€“ Autohaus Heilbronn{% endblock %}

{% block content %}
<div class="finanzierungsanfrage-container">
    <h2> Admin Verwaltung</h2>
    <div class="admin-button-row">
  <a href="{{ url_for('benutzer_verwalten') }}" class="admin-button">ğŸ‘¥ Benutzerverwaltung</a>
  <a href="/auto_verwalten" class="admin-button">ğŸš— Autos verwalten</a>
        <a href="/kaufvertraege" class="admin-button">KaufvertrÃ¤ge</a>

  <form method="post" action="{{ url_for('loesche_abgelehnte_anfragen') }}"
      onsubmit="return confirm('Willst du wirklich alle abgelehnten Anfragen lÃ¶schen?');">
  <button type="submit" class="admin-button">ğŸ—‘ï¸ Abgelehnte Anfragen lÃ¶schen</button>
</form>

  <a href="{{ url_for('anfrage_erstellen') }}" class="admin-button">â• Anfrage erstellen</a>
</div>
{% if geloescht %}
  <div class="loesch-info">
    {{ geloescht }} abgelehnte Anfrage(n) wurden erfolgreich gelÃ¶scht.
  </div>
{% endif %}
    <h2> Finanzierungsanfragen</h2>


    {% for eintrag in anfragen %}
<div class="finanzierungsanfrage-card">
    <div class="auto-bild">
        <img src="{{ url_for('static', filename=eintrag.url) }}" alt="{{ eintrag.marke }} {{ eintrag.modell }}">
    </div>

    <div class="anfrage-details">
        <h3>{{ eintrag.marke }} {{ eintrag.modell }}</h3>
        <p><strong>Termin:</strong> {{ eintrag.Terminwunsch.strftime('%d.%m.%Y, %H:%M Uhr') }}</p>
        <p><strong>Finanzierungsdauer:</strong> {{ eintrag.Monate }} Monate</p>
        <p><strong>Anzahlung:</strong> {{ eintrag.Anzahlung }} â‚¬</p>
        <p><strong>Monatliche Rate:</strong> {{ eintrag.Monatliche_Rate }} â‚¬</p>
        <p><strong>Schlussrate:</strong> {{ eintrag.schlussrate }} â‚¬</p>
        <p><strong>Status:</strong> <span class="status {{ eintrag.Status|lower }}">{{ eintrag.Status|capitalize }}</span></p>
        <p><strong>Info:</strong> {{ eintrag.info or 'â€“' }}</p>


        <hr style="margin: 10px 0;">

        <p><strong>Kunde:</strong> {{ eintrag.vorname }} {{ eintrag.nachname }}</p>
        <p><strong>E-Mail:</strong> {{ eintrag.email }}</p>

        <form method="post" action="{{ url_for('admin_action') }}" class="admin-aktionen-form" style="margin-top: 10px; display: flex; gap: 8px; flex-wrap: wrap;">
            <input type="hidden" name="anfrage_id" value="{{ eintrag.ID }}">
            <button type="submit" name="aktion" value="annehmen">Annehmen</button>
            <button type="submit" name="aktion" value="ablehnen">Ablehnen</button>
        </form>

        <form method="get" action="{{ url_for('kaufvertrag_erstellen', anfrage_id=eintrag.ID) }}" class="admin-aktionen-form" style="margin-top: 10px;">
            <input type="hidden" name="anfrage_id" value="{{ eintrag.ID }}">
            <button type="submit" name="aktion" value="kaufvertrag">Kaufvertrag</button>
        </form>


        <form method="post" action="{{ url_for('anfrage_loeschen_admin', anfrage_id=eintrag.ID) }}" onsubmit="return confirm('Wirklich lÃ¶schen?');" style="margin-top: 10px;">
            <button type="submit" class="btn-anfrage-loeschen">ğŸ—‘ï¸ Anfrage lÃ¶schen</button>
        </form>
    </div>
</div>
{% else %}
<p>Es liegen aktuell keine Finanzierungsanfragen vor.</p>
{% endfor %}
</div>




</div>
{% endblock %}

